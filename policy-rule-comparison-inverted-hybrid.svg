<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="3061pt" height="426pt" viewBox="0.00 0.00 3061.00 426.00">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 422.4)">
<title>CompactHybridInvertedIndexFlow</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-422.4 3056.83,-422.4 3056.83,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="1526.41" y="-10.6" font-family="Arial" font-size="22.00">Hybrid Inverted Index Model (Compact View)</text>
<g id="clust1" class="cluster">
<title>cluster_Stage1</title>
<polygon fill="#f8f9fa" stroke="black" points="8,-295.4 8,-410.4 774.8,-410.4 774.8,-295.4 8,-295.4"/>
<text xml:space="preserve" text-anchor="middle" x="391.4" y="-392" font-family="Arial" font-size="16.00">Stage 1: Indexing (One-time)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_Stage2</title>
<polygon fill="#f8f9fa" stroke="black" points="282.6,-42.4 282.6,-287.4 1598.6,-287.4 1598.6,-42.4 282.6,-42.4"/>
<text xml:space="preserve" text-anchor="middle" x="940.6" y="-269" font-family="Arial" font-size="16.00">Stage 2: Candidate Retrieval</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_Stage3</title>
<polygon fill="#f8f9fa" stroke="black" points="1655.6,-106.4 1655.6,-266.4 3044.83,-266.4 3044.83,-106.4 1655.6,-106.4"/>
<text xml:space="preserve" text-anchor="middle" x="2350.21" y="-248" font-family="Arial" font-size="16.00">Stage 3: Final Ranking</text>
</g>
<!-- S1_LoadRules -->
<g id="node1" class="node">
<title>S1_LoadRules</title>
<path fill="#e6f7ff" stroke="black" d="M205.6,-375.4C205.6,-375.4 28,-375.4 28,-375.4 22,-375.4 16,-369.4 16,-363.4 16,-363.4 16,-315.4 16,-315.4 16,-309.4 22,-303.4 28,-303.4 28,-303.4 205.6,-303.4 205.6,-303.4 211.6,-303.4 217.6,-309.4 217.6,-315.4 217.6,-315.4 217.6,-363.4 217.6,-363.4 217.6,-369.4 211.6,-375.4 205.6,-375.4"/>
<text xml:space="preserve" text-anchor="middle" x="116.8" y="-343.6" font-family="Arial" font-size="14.00">Load</text>
<text xml:space="preserve" text-anchor="middle" x="116.8" y="-326.8" font-family="Arial" font-size="14.00">Rules CSV</text>
</g>
<!-- S1_BuildIndex -->
<g id="node2" class="node">
<title>S1_BuildIndex</title>
<path fill="#add8e6" stroke="black" d="M480.2,-375.4C480.2,-375.4 302.6,-375.4 302.6,-375.4 296.6,-375.4 290.6,-369.4 290.6,-363.4 290.6,-363.4 290.6,-315.4 290.6,-315.4 290.6,-309.4 296.6,-303.4 302.6,-303.4 302.6,-303.4 480.2,-303.4 480.2,-303.4 486.2,-303.4 492.2,-309.4 492.2,-315.4 492.2,-315.4 492.2,-363.4 492.2,-363.4 492.2,-369.4 486.2,-375.4 480.2,-375.4"/>
<text xml:space="preserve" text-anchor="middle" x="391.4" y="-343.6" font-family="Arial" font-size="14.00">Build</text>
<text xml:space="preserve" text-anchor="middle" x="391.4" y="-326.8" font-family="Arial" font-size="14.00">Inverted Index</text>
</g>
<!-- S1_LoadRules&#45;&gt;S1_BuildIndex -->
<g id="edge1" class="edge">
<title>S1_LoadRules-&gt;S1_BuildIndex</title>
<path fill="none" stroke="black" d="M217.88,-339.4C217.88,-339.4 279.02,-339.4 279.02,-339.4"/>
<polygon fill="black" stroke="black" points="279.02,-342.9 289.02,-339.4 279.02,-335.9 279.02,-342.9"/>
</g>
<!-- S1_StoreIndex -->
<g id="node3" class="node">
<title>S1_StoreIndex</title>
<path fill="#eaeaea" stroke="black" d="M766.8,-368.85C766.8,-372.47 721.62,-375.4 666,-375.4 610.38,-375.4 565.2,-372.47 565.2,-368.85 565.2,-368.85 565.2,-309.95 565.2,-309.95 565.2,-306.33 610.38,-303.4 666,-303.4 721.62,-303.4 766.8,-306.33 766.8,-309.95 766.8,-309.95 766.8,-368.85 766.8,-368.85"/>
<path fill="none" stroke="black" d="M766.8,-368.85C766.8,-365.24 721.62,-362.31 666,-362.31 610.38,-362.31 565.2,-365.24 565.2,-368.85"/>
<text xml:space="preserve" text-anchor="middle" x="666" y="-343.6" font-family="Arial" font-size="14.00">Inverted</text>
<text xml:space="preserve" text-anchor="middle" x="666" y="-326.8" font-family="Arial" font-size="14.00">Index</text>
</g>
<!-- S1_BuildIndex&#45;&gt;S1_StoreIndex -->
<g id="edge2" class="edge">
<title>S1_BuildIndex-&gt;S1_StoreIndex</title>
<path fill="none" stroke="black" d="M492.48,-339.4C492.48,-339.4 553.62,-339.4 553.62,-339.4"/>
<polygon fill="black" stroke="black" points="553.62,-342.9 563.62,-339.4 553.62,-335.9 553.62,-342.9"/>
</g>
<!-- S2_Lookup -->
<g id="node6" class="node">
<title>S2_Lookup</title>
<path fill="#ffecb3" stroke="black" d="M1029.4,-231.4C1029.4,-231.4 851.8,-231.4 851.8,-231.4 845.8,-231.4 839.8,-225.4 839.8,-219.4 839.8,-219.4 839.8,-171.4 839.8,-171.4 839.8,-165.4 845.8,-159.4 851.8,-159.4 851.8,-159.4 1029.4,-159.4 1029.4,-159.4 1035.4,-159.4 1041.4,-165.4 1041.4,-171.4 1041.4,-171.4 1041.4,-219.4 1041.4,-219.4 1041.4,-225.4 1035.4,-231.4 1029.4,-231.4"/>
<text xml:space="preserve" text-anchor="middle" x="940.6" y="-199.6" font-family="Arial" font-size="14.00">Lookup Policy Values</text>
<text xml:space="preserve" text-anchor="middle" x="940.6" y="-182.8" font-family="Arial" font-size="14.00">in Index</text>
</g>
<!-- S1_StoreIndex&#45;&gt;S2_Lookup -->
<!-- S2_Start -->
<g id="node4" class="node">
<title>S2_Start</title>
<ellipse fill="#d4edda" stroke="black" cx="391.4" cy="-151.4" rx="100.8" ry="100.8"/>
<text xml:space="preserve" text-anchor="middle" x="391.4" y="-155.6" font-family="Arial" font-size="14.00">New</text>
<text xml:space="preserve" text-anchor="middle" x="391.4" y="-138.8" font-family="Arial" font-size="14.00">Policy</text>
</g>
<!-- S2_Flatten -->
<g id="node5" class="node">
<title>S2_Flatten</title>
<path fill="#e6f7ff" stroke="black" d="M754.8,-207.4C754.8,-207.4 577.2,-207.4 577.2,-207.4 571.2,-207.4 565.2,-201.4 565.2,-195.4 565.2,-195.4 565.2,-147.4 565.2,-147.4 565.2,-141.4 571.2,-135.4 577.2,-135.4 577.2,-135.4 754.8,-135.4 754.8,-135.4 760.8,-135.4 766.8,-141.4 766.8,-147.4 766.8,-147.4 766.8,-195.4 766.8,-195.4 766.8,-201.4 760.8,-207.4 754.8,-207.4"/>
<text xml:space="preserve" text-anchor="middle" x="666" y="-175.6" font-family="Arial" font-size="14.00">Flatten</text>
<text xml:space="preserve" text-anchor="middle" x="666" y="-158.8" font-family="Arial" font-size="14.00">Policy JSON</text>
</g>
<!-- S2_Start&#45;&gt;S2_Flatten -->
<g id="edge3" class="edge">
<title>S2_Start-&gt;S2_Flatten</title>
<path fill="none" stroke="black" d="M490.54,-171.4C490.54,-171.4 553.65,-171.4 553.65,-171.4"/>
<polygon fill="black" stroke="black" points="553.65,-174.9 563.65,-171.4 553.65,-167.9 553.65,-174.9"/>
</g>
<!-- S2_Flatten&#45;&gt;S2_Lookup -->
<g id="edge4" class="edge">
<title>S2_Flatten-&gt;S2_Lookup</title>
<path fill="none" stroke="black" d="M767.08,-183.4C767.08,-183.4 828.22,-183.4 828.22,-183.4"/>
<polygon fill="black" stroke="black" points="828.22,-186.9 838.22,-183.4 828.22,-179.9 828.22,-186.9"/>
</g>
<!-- S2_SelectTopN -->
<g id="node7" class="node">
<title>S2_SelectTopN</title>
<path fill="#add8e6" stroke="black" d="M1304,-231.4C1304,-231.4 1126.4,-231.4 1126.4,-231.4 1120.4,-231.4 1114.4,-225.4 1114.4,-219.4 1114.4,-219.4 1114.4,-171.4 1114.4,-171.4 1114.4,-165.4 1120.4,-159.4 1126.4,-159.4 1126.4,-159.4 1304,-159.4 1304,-159.4 1310,-159.4 1316,-165.4 1316,-171.4 1316,-171.4 1316,-219.4 1316,-219.4 1316,-225.4 1310,-231.4 1304,-231.4"/>
<text xml:space="preserve" text-anchor="middle" x="1215.2" y="-199.6" font-family="Arial" font-size="14.00">Select Top N</text>
<text xml:space="preserve" text-anchor="middle" x="1215.2" y="-182.8" font-family="Arial" font-size="14.00">Candidates</text>
</g>
<!-- S2_Lookup&#45;&gt;S2_SelectTopN -->
<g id="edge5" class="edge">
<title>S2_Lookup-&gt;S2_SelectTopN</title>
<path fill="none" stroke="black" d="M1041.68,-195.4C1041.68,-195.4 1102.82,-195.4 1102.82,-195.4"/>
<polygon fill="black" stroke="black" points="1102.82,-198.9 1112.82,-195.4 1102.82,-191.9 1102.82,-198.9"/>
</g>
<!-- S2_CandidatePool -->
<g id="node8" class="node">
<title>S2_CandidatePool</title>
<path fill="#eaeaea" stroke="black" d="M1590.6,-224.85C1590.6,-228.47 1545.42,-231.4 1489.8,-231.4 1434.18,-231.4 1389,-228.47 1389,-224.85 1389,-224.85 1389,-165.95 1389,-165.95 1389,-162.33 1434.18,-159.4 1489.8,-159.4 1545.42,-159.4 1590.6,-162.33 1590.6,-165.95 1590.6,-165.95 1590.6,-224.85 1590.6,-224.85"/>
<path fill="none" stroke="black" d="M1590.6,-224.85C1590.6,-221.24 1545.42,-218.31 1489.8,-218.31 1434.18,-218.31 1389,-221.24 1389,-224.85"/>
<text xml:space="preserve" text-anchor="middle" x="1489.8" y="-199.6" font-family="Arial" font-size="14.00">Candidate</text>
<text xml:space="preserve" text-anchor="middle" x="1489.8" y="-182.8" font-family="Arial" font-size="14.00">Pool</text>
</g>
<!-- S2_SelectTopN&#45;&gt;S2_CandidatePool -->
<g id="edge6" class="edge">
<title>S2_SelectTopN-&gt;S2_CandidatePool</title>
<path fill="none" stroke="black" d="M1316.28,-195.4C1316.28,-195.4 1377.42,-195.4 1377.42,-195.4"/>
<polygon fill="black" stroke="black" points="1377.42,-198.9 1387.42,-195.4 1377.42,-191.9 1377.42,-198.9"/>
</g>
<!-- S3_LoopStart -->
<g id="node9" class="node">
<title>S3_LoopStart</title>
<path fill="lightgrey" stroke="none" d="M1853.2,-231.4C1853.2,-231.4 1675.6,-231.4 1675.6,-231.4 1669.6,-231.4 1663.6,-225.4 1663.6,-219.4 1663.6,-219.4 1663.6,-171.4 1663.6,-171.4 1663.6,-165.4 1669.6,-159.4 1675.6,-159.4 1675.6,-159.4 1853.2,-159.4 1853.2,-159.4 1859.2,-159.4 1865.2,-165.4 1865.2,-171.4 1865.2,-171.4 1865.2,-219.4 1865.2,-219.4 1865.2,-225.4 1859.2,-231.4 1853.2,-231.4"/>
<text xml:space="preserve" text-anchor="middle" x="1764.4" y="-199.6" font-family="Arial" font-size="14.00">For Each</text>
<text xml:space="preserve" text-anchor="middle" x="1764.4" y="-182.8" font-family="Arial" font-size="14.00">Candidate...</text>
</g>
<!-- S2_CandidatePool&#45;&gt;S3_LoopStart -->
<g id="edge14" class="edge">
<title>S2_CandidatePool-&gt;S3_LoopStart</title>
<path fill="none" stroke="black" d="M1590.88,-195.4C1590.88,-195.4 1652.48,-195.4 1652.48,-195.4"/>
<polygon fill="black" stroke="black" points="1652.48,-198.9 1662.48,-195.4 1652.48,-191.9 1652.48,-198.9"/>
</g>
<!-- S3_Validate -->
<g id="node10" class="node">
<title>S3_Validate</title>
<polygon fill="#fff3cd" stroke="black" points="2059.78,-186.4 1958.98,-150.4 2059.78,-114.4 2160.58,-150.4 2059.78,-186.4"/>
<text xml:space="preserve" text-anchor="middle" x="2059.78" y="-154.6" font-family="Arial" font-size="14.00">'must_match'</text>
<text xml:space="preserve" text-anchor="middle" x="2059.78" y="-137.8" font-family="Arial" font-size="14.00">Validation</text>
</g>
<!-- S3_LoopStart&#45;&gt;S3_Validate -->
<g id="edge7" class="edge">
<title>S3_LoopStart-&gt;S3_Validate</title>
<path fill="none" stroke="black" d="M1864.81,-168.4C1864.81,-168.4 1996.62,-168.4 1996.62,-168.4"/>
<polygon fill="black" stroke="black" points="1996.62,-171.9 2006.62,-168.4 1996.62,-164.9 1996.62,-171.9"/>
</g>
<!-- S3_Validate&#45;&gt;S3_LoopStart -->
<g id="edge9" class="edge">
<title>S3_Validate-&gt;S3_LoopStart</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M2033.31,-177.4C2033.31,-177.4 1876.41,-177.4 1876.41,-177.4"/>
<polygon fill="red" stroke="red" points="1876.41,-173.9 1866.41,-177.4 1876.41,-180.9 1876.41,-173.9"/>
<text xml:space="preserve" text-anchor="middle" x="1912.09" y="-201.6" font-family="Times,serif" font-size="14.00">Fail</text>
</g>
<!-- S3_ScoreRule -->
<g id="node11" class="node">
<title>S3_ScoreRule</title>
<path fill="#add8e6" stroke="black" d="M2447.08,-212.4C2447.08,-212.4 2269.48,-212.4 2269.48,-212.4 2263.48,-212.4 2257.48,-206.4 2257.48,-200.4 2257.48,-200.4 2257.48,-152.4 2257.48,-152.4 2257.48,-146.4 2263.48,-140.4 2269.48,-140.4 2269.48,-140.4 2447.08,-140.4 2447.08,-140.4 2453.08,-140.4 2459.08,-146.4 2459.08,-152.4 2459.08,-152.4 2459.08,-200.4 2459.08,-200.4 2459.08,-206.4 2453.08,-212.4 2447.08,-212.4"/>
<text xml:space="preserve" text-anchor="middle" x="2358.28" y="-180.6" font-family="Arial" font-size="14.00">Calculate</text>
<text xml:space="preserve" text-anchor="middle" x="2358.28" y="-163.8" font-family="Arial" font-size="14.00">Weighted Score</text>
</g>
<!-- S3_Validate&#45;&gt;S3_ScoreRule -->
<g id="edge8" class="edge">
<title>S3_Validate-&gt;S3_ScoreRule</title>
<path fill="none" stroke="black" d="M2125.66,-163.4C2125.66,-163.4 2245.55,-163.4 2245.55,-163.4"/>
<polygon fill="black" stroke="black" points="2245.55,-166.9 2255.55,-163.4 2245.55,-159.9 2245.55,-166.9"/>
<text xml:space="preserve" text-anchor="middle" x="2209.03" y="-171.6" font-family="Times,serif" font-size="14.00">Pass</text>
</g>
<!-- S3_ScoreRule&#45;&gt;S3_LoopStart -->
<g id="edge10" class="edge">
<title>S3_ScoreRule-&gt;S3_LoopStart</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2257.2,-199.4C2257.2,-199.4 1876.53,-199.4 1876.53,-199.4"/>
<polygon fill="black" stroke="black" points="1876.53,-195.9 1866.53,-199.4 1876.53,-202.9 1876.53,-195.9"/>
</g>
<!-- S3_Sort -->
<g id="node12" class="node">
<title>S3_Sort</title>
<path fill="#d1ecf1" stroke="black" d="M2750.23,-212.4C2750.23,-212.4 2572.63,-212.4 2572.63,-212.4 2566.63,-212.4 2560.63,-206.4 2560.63,-200.4 2560.63,-200.4 2560.63,-152.4 2560.63,-152.4 2560.63,-146.4 2566.63,-140.4 2572.63,-140.4 2572.63,-140.4 2750.23,-140.4 2750.23,-140.4 2756.23,-140.4 2762.23,-146.4 2762.23,-152.4 2762.23,-152.4 2762.23,-200.4 2762.23,-200.4 2762.23,-206.4 2756.23,-212.4 2750.23,-212.4"/>
<text xml:space="preserve" text-anchor="middle" x="2661.43" y="-180.6" font-family="Arial" font-size="14.00">Sort All Scored</text>
<text xml:space="preserve" text-anchor="middle" x="2661.43" y="-163.8" font-family="Arial" font-size="14.00">Candidates</text>
</g>
<!-- S3_ScoreRule&#45;&gt;S3_Sort -->
<g id="edge11" class="edge">
<title>S3_ScoreRule-&gt;S3_Sort</title>
<path fill="none" stroke="black" d="M2459.22,-176.4C2459.22,-176.4 2548.63,-176.4 2548.63,-176.4"/>
<polygon fill="black" stroke="black" points="2548.63,-179.9 2558.63,-176.4 2548.63,-172.9 2548.63,-179.9"/>
<text xml:space="preserve" text-anchor="middle" x="2509.85" y="-197.4" font-family="Times,serif" font-size="14.00">Loop</text>
<text xml:space="preserve" text-anchor="middle" x="2509.85" y="-180.6" font-family="Times,serif" font-size="14.00">Ends</text>
</g>
<!-- S3_Output -->
<g id="node13" class="node">
<title>S3_Output</title>
<polygon fill="#fefee3" stroke="black" points="3030.83,-212.4 2835.23,-212.4 2835.23,-140.4 3036.83,-140.4 3036.83,-206.4 3030.83,-212.4"/>
<polyline fill="none" stroke="black" points="3030.83,-212.4 3030.83,-206.4"/>
<polyline fill="none" stroke="black" points="3036.83,-206.4 3030.83,-206.4"/>
<text xml:space="preserve" text-anchor="middle" x="2936.03" y="-180.6" font-family="Arial" font-size="14.00">Final JSON</text>
<text xml:space="preserve" text-anchor="middle" x="2936.03" y="-163.8" font-family="Arial" font-size="14.00">Output</text>
</g>
<!-- S3_Sort&#45;&gt;S3_Output -->
<g id="edge12" class="edge">
<title>S3_Sort-&gt;S3_Output</title>
<path fill="none" stroke="black" d="M2762.51,-176.4C2762.51,-176.4 2823.65,-176.4 2823.65,-176.4"/>
<polygon fill="black" stroke="black" points="2823.65,-179.9 2833.65,-176.4 2823.65,-172.9 2823.65,-179.9"/>
</g>
</g>
</svg>